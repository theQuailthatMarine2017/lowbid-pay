exports.generate = function(environment,consumerKey,consumerSecret,fn) {

    var unirest = require("unirest");

    if(environment === 'production' || environment === 'PRODUCTION'){

        var req = unirest("GET", "https://api.safaricom.co.ke/oauth/v1/generate");
        let data = consumerKey+':'+consumerSecret;
        let base64string = Buffer.from(data, 'utf-8').toString('base64');

            req.query({
             "grant_type": "client_credentials"
            });
            
            req.headers({
             "Authorization": `Basic ${base64string}`
            });
            
            req.end(res => {
             if (res.error) rejects(res.error);
            fn({code: res.body.access_token, expire: Math.floor(res.body.expires_in / 60)});
            //     console.log("Your Bearer Auth Token Is: "+ res.body.access_token+ `\nToken Expires After: ${Math.floor(res.body.expires_in / 60)} Minutes`+ "\n\n****************");
            });

    }
}
